<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}</title>

  <meta property="description" itemprop="description" content="Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-01-13"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-01-13"/>
  <meta name="article:author" content="Peter Higgins"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}"/>
  <meta property="twitter:description" content="Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}"]},{"type":"character","attributes":{},"value":["Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Peter Higgins"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":[]}},"value":[]}]}]},{"type":"character","attributes":{},"value":["01-13-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["~$bp_pilot.xlsx","bp_pilot.xlsx","extracting-highlighting-as-data-from-excel_files/anchor-4.2.2/anchor.min.js","extracting-highlighting-as-data-from-excel_files/bowser-1.9.3/bowser.min.js","extracting-highlighting-as-data-from-excel_files/distill-2.2.21/template.v2.js","extracting-highlighting-as-data-from-excel_files/header-attrs-2.6/header-attrs.js","extracting-highlighting-as-data-from-excel_files/jquery-1.11.3/jquery.min.js","extracting-highlighting-as-data-from-excel_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="extracting-highlighting-as-data-from-excel_files/header-attrs-2.6/header-attrs.js"></script>
  <script src="extracting-highlighting-as-data-from-excel_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="extracting-highlighting-as-data-from-excel_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="extracting-highlighting-as-data-from-excel_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="extracting-highlighting-as-data-from-excel_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="extracting-highlighting-as-data-from-excel_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}","description":"Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information.","authors":[{"author":"Peter Higgins","authorURL":{},"affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-13T00:00:00.000+00:00","citationText":"Higgins, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Extracting Highlighting as Data from Excel Spreadsheets with {tidyxl}</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Sometimes well-meaning people encode variables in medical data as highlighting with colors. For example, a spreadsheet where the control patients are in the green rows, and the test patients are in the red rows. This should have been encoded as a study_arm variable with values control and test. How to fix this - the {tidyxl} package can get under the hood of an excel spreadsheet and extract this information.</p></p>
</div>

<div class="d-byline">
  Peter Higgins true 
  
<br/>01-13-2021
</div>

<div class="d-article">
<h2 id="the-excel-spreadsheet">The Excel Spreadsheet</h2>
<p>So you, have unfortunately, agreed to try to analyze data in which a well-meaning person has encoded a variable as highlighter colors.</p>
<p>Yellow rows = control arm<br> Red rows = test arm <br></p>
<p>Is there an alternative to manually typing in a new variable, <strong>study_arm</strong>, with values “control” and “test”?</p>
<p>Fortunately, the {tidyxl} package can help, by getting under the hood and into the structure of this excel (xlsx) spreadsheet.</p>
<h2 id="getting-started">Getting started</h2>
<p>Let’s start with a simple example, included in the {tidyxl} package. First load the tidyxl and readxl packages, and read in the excel file from the package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'># read in file from package</span>
<span class='va'>titanic</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/titanic.xlsx"</span>, package <span class='op'>=</span> <span class='st'>"tidyxl"</span><span class='op'>)</span>
<span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>titanic</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 10 x 7
   ...1  ...2   Age      Child ...5  Adult ...7 
   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 &lt;NA&gt;  &lt;NA&gt;   Survived No    Yes   No    Yes  
 2 Class Sex    &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 3 1st   Male   &lt;NA&gt;     0     5     118   57   
 4 &lt;NA&gt;  Female &lt;NA&gt;     0     1     4     140  
 5 2nd   Male   &lt;NA&gt;     0     11    154   14   
 6 &lt;NA&gt;  Female &lt;NA&gt;     0     13    13    80   
 7 3rd   Male   &lt;NA&gt;     35    13    387   75   
 8 &lt;NA&gt;  Female &lt;NA&gt;     17    14    89    76   
 9 Crew  Male   &lt;NA&gt;     0     0     670   192  
10 &lt;NA&gt;  Female &lt;NA&gt;     0     0     3     20   </code></pre>
</div>
<h2 id="extracting-cell-data">Extracting Cell Data</h2>
<p>We would like to identify and extract the cells highlighted in yellow. In this case, these are the cells in row 10 (row 11 in Excel, counting the header row), for the variables Adult and …7. But this is not obvious from the tibble. So we will have to dig deeper into the xlsx file with the help of {tidyxl}. Let’s use the <em>xlsx_cells()</em> function to get more information on each cell, and store this in the object, x.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'>xlsx_cells</span><span class='op'>(</span><span class='va'>titanic</span><span class='op'>)</span>
<span class='va'>x</span>
</code></pre>
</div>
<pre><code># A tibble: 60 x 21
   sheet address   row   col is_blank data_type error logical numeric
   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;lgl&gt;    &lt;chr&gt;     &lt;chr&gt; &lt;lgl&gt;     &lt;dbl&gt;
 1 Shee… C1          1     3 FALSE    character &lt;NA&gt;  NA           NA
 2 Shee… D1          1     4 FALSE    character &lt;NA&gt;  NA           NA
 3 Shee… E1          1     5 TRUE     blank     &lt;NA&gt;  NA           NA
 4 Shee… F1          1     6 FALSE    character &lt;NA&gt;  NA           NA
 5 Shee… G1          1     7 TRUE     blank     &lt;NA&gt;  NA           NA
 6 Shee… C2          2     3 FALSE    character &lt;NA&gt;  NA           NA
 7 Shee… D2          2     4 FALSE    character &lt;NA&gt;  NA           NA
 8 Shee… E2          2     5 FALSE    character &lt;NA&gt;  NA           NA
 9 Shee… F2          2     6 FALSE    character &lt;NA&gt;  NA           NA
10 Shee… G2          2     7 FALSE    character &lt;NA&gt;  NA           NA
# … with 50 more rows, and 12 more variables: date &lt;dttm&gt;,
#   character &lt;chr&gt;, character_formatted &lt;list&gt;, formula &lt;chr&gt;,
#   is_array &lt;lgl&gt;, formula_ref &lt;chr&gt;, formula_group &lt;int&gt;,
#   comment &lt;chr&gt;, height &lt;dbl&gt;, width &lt;dbl&gt;, style_format &lt;chr&gt;,
#   local_format_id &lt;int&gt;</code></pre>
</div>
<p>Now we have information on each cell (identified by address) in each sheet, with row and column information, details on data_type, formulas, comments, style_format, and the underlying data in separate columns by data type. This helps us find (and filter) for specific cells or rows.</p>
<h2 id="extracting-formatting-data">Extracting Formatting Data</h2>
<p>But we also need to get at the formatting. This can be done with <em>xls_formats()</em> from {tidyxl}. <strong>Warning:</strong> the output will be very long and icky. Be prepared to scroll down a lot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>formats</span> <span class='op'>&lt;-</span> <span class='fu'>xlsx_formats</span><span class='op'>(</span><span class='va'>titanic</span><span class='op'>)</span>
<span class='va'>formats</span>
</code></pre>
</div>
<pre><code>$local
$local$numFmt
[1] &quot;General&quot; &quot;General&quot; &quot;General&quot; &quot;General&quot;

$local$font
$local$font$bold
[1] FALSE  TRUE FALSE FALSE

$local$font$italic
[1] FALSE FALSE  TRUE FALSE

$local$font$underline
[1] NA NA NA NA

$local$font$strike
[1] FALSE FALSE FALSE FALSE

$local$font$vertAlign
[1] NA NA NA NA

$local$font$size
[1] 11 11 11 11

$local$font$color
$local$font$color$rgb
[1] &quot;FF000000&quot; &quot;FF000000&quot; &quot;FF000000&quot; &quot;FF000000&quot;

$local$font$color$theme
[1] &quot;text1&quot; &quot;text1&quot; &quot;text1&quot; &quot;text1&quot;

$local$font$color$indexed
[1] NA NA NA NA

$local$font$color$tint
[1] NA NA NA NA


$local$font$name
[1] &quot;Calibri&quot; &quot;Calibri&quot; &quot;Calibri&quot; &quot;Calibri&quot;

$local$font$family
[1] 2 2 2 2

$local$font$scheme
[1] &quot;minor&quot; &quot;minor&quot; &quot;minor&quot; &quot;minor&quot;


$local$fill
$local$fill$patternFill
$local$fill$patternFill$fgColor
$local$fill$patternFill$fgColor$rgb
[1] NA         NA         NA         &quot;FFFFFF00&quot;

$local$fill$patternFill$fgColor$theme
[1] NA NA NA NA

$local$fill$patternFill$fgColor$indexed
[1] NA NA NA NA

$local$fill$patternFill$fgColor$tint
[1] NA NA NA NA


$local$fill$patternFill$bgColor
$local$fill$patternFill$bgColor$rgb
[1] NA         NA         NA         &quot;FFFFFFFF&quot;

$local$fill$patternFill$bgColor$theme
[1] NA NA NA NA

$local$fill$patternFill$bgColor$indexed
[1] NA NA NA 65

$local$fill$patternFill$bgColor$tint
[1] NA NA NA NA


$local$fill$patternFill$patternType
[1] NA      NA      NA      &quot;solid&quot;


$local$fill$gradientFill
$local$fill$gradientFill$type
[1] NA NA NA NA

$local$fill$gradientFill$degree
[1] NA NA NA NA

$local$fill$gradientFill$left
[1] NA NA NA NA

$local$fill$gradientFill$right
[1] NA NA NA NA

$local$fill$gradientFill$top
[1] NA NA NA NA

$local$fill$gradientFill$bottom
[1] NA NA NA NA

$local$fill$gradientFill$stop1
$local$fill$gradientFill$stop1$position
[1] NA NA NA NA

$local$fill$gradientFill$stop1$color
$local$fill$gradientFill$stop1$color$rgb
[1] NA NA NA NA

$local$fill$gradientFill$stop1$color$theme
[1] NA NA NA NA

$local$fill$gradientFill$stop1$color$indexed
[1] NA NA NA NA

$local$fill$gradientFill$stop1$color$tint
[1] NA NA NA NA



$local$fill$gradientFill$stop2
$local$fill$gradientFill$stop2$position
[1] NA NA NA NA

$local$fill$gradientFill$stop2$color
$local$fill$gradientFill$stop2$color$rgb
[1] NA NA NA NA

$local$fill$gradientFill$stop2$color$theme
[1] NA NA NA NA

$local$fill$gradientFill$stop2$color$indexed
[1] NA NA NA NA

$local$fill$gradientFill$stop2$color$tint
[1] NA NA NA NA





$local$border
$local$border$diagonalDown
[1] FALSE FALSE FALSE FALSE

$local$border$diagonalUp
[1] FALSE FALSE FALSE FALSE

$local$border$outline
[1] FALSE FALSE FALSE FALSE

$local$border$left
$local$border$left$style
[1] NA NA NA NA

$local$border$left$color
$local$border$left$color$rgb
[1] NA NA NA NA

$local$border$left$color$theme
[1] NA NA NA NA

$local$border$left$color$indexed
[1] NA NA NA NA

$local$border$left$color$tint
[1] NA NA NA NA



$local$border$right
$local$border$right$style
[1] NA NA NA NA

$local$border$right$color
$local$border$right$color$rgb
[1] NA NA NA NA

$local$border$right$color$theme
[1] NA NA NA NA

$local$border$right$color$indexed
[1] NA NA NA NA

$local$border$right$color$tint
[1] NA NA NA NA



$local$border$start
$local$border$start$style
[1] NA NA NA NA

$local$border$start$color
$local$border$start$color$rgb
[1] NA NA NA NA

$local$border$start$color$theme
[1] NA NA NA NA

$local$border$start$color$indexed
[1] NA NA NA NA

$local$border$start$color$tint
[1] NA NA NA NA



$local$border$end
$local$border$end$style
[1] NA NA NA NA

$local$border$end$color
$local$border$end$color$rgb
[1] NA NA NA NA

$local$border$end$color$theme
[1] NA NA NA NA

$local$border$end$color$indexed
[1] NA NA NA NA

$local$border$end$color$tint
[1] NA NA NA NA



$local$border$top
$local$border$top$style
[1] NA NA NA NA

$local$border$top$color
$local$border$top$color$rgb
[1] NA NA NA NA

$local$border$top$color$theme
[1] NA NA NA NA

$local$border$top$color$indexed
[1] NA NA NA NA

$local$border$top$color$tint
[1] NA NA NA NA



$local$border$bottom
$local$border$bottom$style
[1] NA NA NA NA

$local$border$bottom$color
$local$border$bottom$color$rgb
[1] NA NA NA NA

$local$border$bottom$color$theme
[1] NA NA NA NA

$local$border$bottom$color$indexed
[1] NA NA NA NA

$local$border$bottom$color$tint
[1] NA NA NA NA



$local$border$diagonal
$local$border$diagonal$style
[1] NA NA NA NA

$local$border$diagonal$color
$local$border$diagonal$color$rgb
[1] NA NA NA NA

$local$border$diagonal$color$theme
[1] NA NA NA NA

$local$border$diagonal$color$indexed
[1] NA NA NA NA

$local$border$diagonal$color$tint
[1] NA NA NA NA



$local$border$vertical
$local$border$vertical$style
[1] NA NA NA NA

$local$border$vertical$color
$local$border$vertical$color$rgb
[1] NA NA NA NA

$local$border$vertical$color$theme
[1] NA NA NA NA

$local$border$vertical$color$indexed
[1] NA NA NA NA

$local$border$vertical$color$tint
[1] NA NA NA NA



$local$border$horizontal
$local$border$horizontal$style
[1] NA NA NA NA

$local$border$horizontal$color
$local$border$horizontal$color$rgb
[1] NA NA NA NA

$local$border$horizontal$color$theme
[1] NA NA NA NA

$local$border$horizontal$color$indexed
[1] NA NA NA NA

$local$border$horizontal$color$tint
[1] NA NA NA NA




$local$alignment
$local$alignment$horizontal
[1] &quot;general&quot; &quot;general&quot; &quot;general&quot; &quot;general&quot;

$local$alignment$vertical
[1] &quot;bottom&quot; &quot;bottom&quot; &quot;bottom&quot; &quot;bottom&quot;

$local$alignment$wrapText
[1] FALSE FALSE FALSE FALSE

$local$alignment$readingOrder
[1] &quot;context&quot; &quot;context&quot; &quot;context&quot; &quot;context&quot;

$local$alignment$indent
[1] 0 0 0 0

$local$alignment$justifyLastLine
[1] FALSE FALSE FALSE FALSE

$local$alignment$shrinkToFit
[1] FALSE FALSE FALSE FALSE

$local$alignment$textRotation
[1] 0 0 0 0


$local$protection
$local$protection$locked
[1] TRUE TRUE TRUE TRUE

$local$protection$hidden
[1] FALSE FALSE FALSE FALSE



$style
$style$numFmt
   Normal 
&quot;General&quot; 

$style$font
$style$font$bold
Normal 
 FALSE 

$style$font$italic
Normal 
 FALSE 

$style$font$underline
Normal 
    NA 

$style$font$strike
Normal 
 FALSE 

$style$font$vertAlign
Normal 
    NA 

$style$font$size
Normal 
    11 

$style$font$color
$style$font$color$rgb
    Normal 
&quot;FF000000&quot; 

$style$font$color$theme
 Normal 
&quot;text1&quot; 

$style$font$color$indexed
Normal 
    NA 

$style$font$color$tint
Normal 
    NA 


$style$font$name
   Normal 
&quot;Calibri&quot; 

$style$font$family
Normal 
     2 

$style$font$scheme
 Normal 
&quot;minor&quot; 


$style$fill
$style$fill$patternFill
$style$fill$patternFill$fgColor
$style$fill$patternFill$fgColor$rgb
Normal 
    NA 

$style$fill$patternFill$fgColor$theme
Normal 
    NA 

$style$fill$patternFill$fgColor$indexed
Normal 
    NA 

$style$fill$patternFill$fgColor$tint
Normal 
    NA 


$style$fill$patternFill$bgColor
$style$fill$patternFill$bgColor$rgb
Normal 
    NA 

$style$fill$patternFill$bgColor$theme
Normal 
    NA 

$style$fill$patternFill$bgColor$indexed
Normal 
    NA 

$style$fill$patternFill$bgColor$tint
Normal 
    NA 


$style$fill$patternFill$patternType
Normal 
    NA 


$style$fill$gradientFill
$style$fill$gradientFill$type
Normal 
    NA 

$style$fill$gradientFill$degree
Normal 
    NA 

$style$fill$gradientFill$left
Normal 
    NA 

$style$fill$gradientFill$right
Normal 
    NA 

$style$fill$gradientFill$top
Normal 
    NA 

$style$fill$gradientFill$bottom
Normal 
    NA 

$style$fill$gradientFill$stop1
$style$fill$gradientFill$stop1$position
Normal 
    NA 

$style$fill$gradientFill$stop1$color
$style$fill$gradientFill$stop1$color$rgb
Normal 
    NA 

$style$fill$gradientFill$stop1$color$theme
Normal 
    NA 

$style$fill$gradientFill$stop1$color$indexed
Normal 
    NA 

$style$fill$gradientFill$stop1$color$tint
Normal 
    NA 



$style$fill$gradientFill$stop2
$style$fill$gradientFill$stop2$position
Normal 
    NA 

$style$fill$gradientFill$stop2$color
$style$fill$gradientFill$stop2$color$rgb
Normal 
    NA 

$style$fill$gradientFill$stop2$color$theme
Normal 
    NA 

$style$fill$gradientFill$stop2$color$indexed
Normal 
    NA 

$style$fill$gradientFill$stop2$color$tint
Normal 
    NA 





$style$border
$style$border$diagonalDown
Normal 
 FALSE 

$style$border$diagonalUp
Normal 
 FALSE 

$style$border$outline
Normal 
 FALSE 

$style$border$left
$style$border$left$style
Normal 
    NA 

$style$border$left$color
$style$border$left$color$rgb
Normal 
    NA 

$style$border$left$color$theme
Normal 
    NA 

$style$border$left$color$indexed
Normal 
    NA 

$style$border$left$color$tint
Normal 
    NA 



$style$border$right
$style$border$right$style
Normal 
    NA 

$style$border$right$color
$style$border$right$color$rgb
Normal 
    NA 

$style$border$right$color$theme
Normal 
    NA 

$style$border$right$color$indexed
Normal 
    NA 

$style$border$right$color$tint
Normal 
    NA 



$style$border$start
$style$border$start$style
Normal 
    NA 

$style$border$start$color
$style$border$start$color$rgb
Normal 
    NA 

$style$border$start$color$theme
Normal 
    NA 

$style$border$start$color$indexed
Normal 
    NA 

$style$border$start$color$tint
Normal 
    NA 



$style$border$end
$style$border$end$style
Normal 
    NA 

$style$border$end$color
$style$border$end$color$rgb
Normal 
    NA 

$style$border$end$color$theme
Normal 
    NA 

$style$border$end$color$indexed
Normal 
    NA 

$style$border$end$color$tint
Normal 
    NA 



$style$border$top
$style$border$top$style
Normal 
    NA 

$style$border$top$color
$style$border$top$color$rgb
Normal 
    NA 

$style$border$top$color$theme
Normal 
    NA 

$style$border$top$color$indexed
Normal 
    NA 

$style$border$top$color$tint
Normal 
    NA 



$style$border$bottom
$style$border$bottom$style
Normal 
    NA 

$style$border$bottom$color
$style$border$bottom$color$rgb
Normal 
    NA 

$style$border$bottom$color$theme
Normal 
    NA 

$style$border$bottom$color$indexed
Normal 
    NA 

$style$border$bottom$color$tint
Normal 
    NA 



$style$border$diagonal
$style$border$diagonal$style
Normal 
    NA 

$style$border$diagonal$color
$style$border$diagonal$color$rgb
Normal 
    NA 

$style$border$diagonal$color$theme
Normal 
    NA 

$style$border$diagonal$color$indexed
Normal 
    NA 

$style$border$diagonal$color$tint
Normal 
    NA 



$style$border$vertical
$style$border$vertical$style
Normal 
    NA 

$style$border$vertical$color
$style$border$vertical$color$rgb
Normal 
    NA 

$style$border$vertical$color$theme
Normal 
    NA 

$style$border$vertical$color$indexed
Normal 
    NA 

$style$border$vertical$color$tint
Normal 
    NA 



$style$border$horizontal
$style$border$horizontal$style
Normal 
    NA 

$style$border$horizontal$color
$style$border$horizontal$color$rgb
Normal 
    NA 

$style$border$horizontal$color$theme
Normal 
    NA 

$style$border$horizontal$color$indexed
Normal 
    NA 

$style$border$horizontal$color$tint
Normal 
    NA 




$style$alignment
$style$alignment$horizontal
   Normal 
&quot;general&quot; 

$style$alignment$vertical
  Normal 
&quot;bottom&quot; 

$style$alignment$wrapText
Normal 
 FALSE 

$style$alignment$readingOrder
   Normal 
&quot;context&quot; 

$style$alignment$indent
Normal 
     0 

$style$alignment$justifyLastLine
Normal 
 FALSE 

$style$alignment$shrinkToFit
Normal 
 FALSE 

$style$alignment$textRotation
Normal 
     0 


$style$protection
$style$protection$locked
Normal 
  TRUE 

$style$protection$hidden
Normal 
 FALSE </code></pre>
</div>
<p>This gives you the formats object, which is of the <em>list</em> class. This is a highly nested data structure, which you can get a feel of from the printed output. You can also explore <strong>formats</strong> by clicking on it in the Environment Tab, then a tab for formats will open up in the Source Pane. Click on the blue arrow to the left of formats in the Source Pane - then dig deeper into the nesting by clicking on the blue arrow in turn for</p>
<ul>
<li><p>local</p></li>
<li><p>fill</p></li>
<li><p>patternFill</p></li>
<li><p>fgColor (foreground color)</p></li>
<li><p>rgb (the only one with content)</p></li>
</ul>
<p>We are looking for the fill (highlighting) for the two cells highlighted in yellow.</p>
<p>This can be found programmatically with</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>formats</span><span class='op'>$</span><span class='va'>local</span><span class='op'>$</span><span class='va'>fill</span><span class='op'>$</span><span class='va'>patternFill</span><span class='op'>$</span><span class='va'>fgColor</span><span class='op'>$</span><span class='va'>rgb</span>
</code></pre>
</div>
<pre><code>[1] NA         NA         NA         &quot;FFFFFF00&quot;</code></pre>
</div>
<p>which is honestly, quite hideous.</p>
<p>But a nested list is an efficient way to store information when there are a lot of empty cells. Most of the cells will not be highlighted, so the folks who wrote Excel used this approach. The output identifies one RGB highlighting color used as a fill in this spreadsheet, “FFFFFF00”, which is yellow.</p>
<h2 id="isolating-the-highlighted-cells">Isolating the Highlighted Cells</h2>
<p>The hard part is knowing where to hunt for the formatting you want to find. Digging around in the nested structure in the Source pane can help (especially if you have suggestions from the {tidyxl} web page). Once we have this color information, we can filter our x object to just the yellow-highlighted cells, with</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>x</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>local_format_id</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>formats</span><span class='op'>$</span><span class='va'>local</span><span class='op'>$</span><span class='va'>fill</span><span class='op'>$</span><span class='va'>patternFill</span><span class='op'>$</span><span class='va'>fgColor</span><span class='op'>$</span><span class='va'>rgb</span> <span class='op'>==</span> <span class='st'>"FFFFFF00"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>address</span>, <span class='va'>data_type</span><span class='op'>)</span> <span class='op'>-&gt;</span>
<span class='va'>location</span>
<span class='va'>location</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 2
  address data_type
  &lt;chr&gt;   &lt;chr&gt;    
1 F11     numeric  
2 G11     numeric  </code></pre>
</div>
<p>This takes the <code>x</code> object, then filters it on the local_format_id variable for a local format in which the fill color is yellow (which in this case turns out to be local_format_id = 4). Then we select the address column to get the cells that have been highlighted in the spreadsheet (F11 and G11 in this case).</p>
<h2 id="finding-the-highlighted-values">Finding the Highlighted Values</h2>
<p>To get the highlighted values out, as these cells both contain numeric data, we can do the following:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>x</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>address</span> <span class='op'>%in%</span> <span class='va'>location</span><span class='op'>$</span><span class='va'>address</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>address</span>, <span class='va'>numeric</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 2
  address numeric
  &lt;chr&gt;     &lt;dbl&gt;
1 F11           3
2 G11          20</code></pre>
</div>
<p>So the highlighted values are 3 and 20.</p>
<h2 id="a-pilot-trial">A Pilot Trial</h2>
<p>Imagine a pilot trial of blood pressure medication with the study arm encoded as a highlighting color by row. Let’s read in the excel file.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot_path</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='op'>(</span><span class='st'>"_posts/2021-01-13-extracting-highlighting-as-data-from-excel/bp_pilot.xlsx"</span><span class='op'>)</span>
<span class='va'>pilot</span> <span class='op'>&lt;-</span> <span class='fu'>read_xlsx</span><span class='op'>(</span><span class='va'>pilot_path</span><span class='op'>)</span>
<span class='va'>pilot</span>
</code></pre>
</div>
<pre><code># A tibble: 11 x 7
   pat_id  sbp1  sbp2   hr1   hr2  dbp1  dbp2
    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1      1   147   129    72    73    94    82
 2      2   161   163    75    77    88    87
 3      3   154   133    68    66    96    84
 4      4   150   152    84    88    89    88
 5      5   179   159    82    80    92    81
 6      6   166   164    71    69    92    93
 7      7   168   137    65    53    95    82
 8      8   154   155    77    75    94    95
 9      9   146   122    83    81    92    78
10     10   172   171    86    84    95    95
11     11   147   148    74    74    88    89</code></pre>
</div>
<p>From this tibble, we can’t see which rows were coded as test (red) vs. control (green). Let’s follow the same approach - first we will extract cell data.</p>
<h2 id="extracting-cell-data-1">Extracting Cell Data</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot_cells</span> <span class='op'>&lt;-</span> <span class='fu'>xlsx_cells</span><span class='op'>(</span><span class='va'>pilot_path</span><span class='op'>)</span>
<span class='va'>pilot_cells</span>
</code></pre>
</div>
<pre><code># A tibble: 84 x 21
   sheet address   row   col is_blank data_type error logical numeric
   &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;lgl&gt;    &lt;chr&gt;     &lt;chr&gt; &lt;lgl&gt;     &lt;dbl&gt;
 1 Shee… A1          1     1 FALSE    character &lt;NA&gt;  NA           NA
 2 Shee… B1          1     2 FALSE    character &lt;NA&gt;  NA           NA
 3 Shee… C1          1     3 FALSE    character &lt;NA&gt;  NA           NA
 4 Shee… D1          1     4 FALSE    character &lt;NA&gt;  NA           NA
 5 Shee… E1          1     5 FALSE    character &lt;NA&gt;  NA           NA
 6 Shee… F1          1     6 FALSE    character &lt;NA&gt;  NA           NA
 7 Shee… G1          1     7 FALSE    character &lt;NA&gt;  NA           NA
 8 Shee… A2          2     1 FALSE    numeric   &lt;NA&gt;  NA            1
 9 Shee… B2          2     2 FALSE    numeric   &lt;NA&gt;  NA          147
10 Shee… C2          2     3 FALSE    numeric   &lt;NA&gt;  NA          129
# … with 74 more rows, and 12 more variables: date &lt;dttm&gt;,
#   character &lt;chr&gt;, character_formatted &lt;list&gt;, formula &lt;chr&gt;,
#   is_array &lt;lgl&gt;, formula_ref &lt;chr&gt;, formula_group &lt;int&gt;,
#   comment &lt;chr&gt;, height &lt;dbl&gt;, width &lt;dbl&gt;, style_format &lt;chr&gt;,
#   local_format_id &lt;int&gt;</code></pre>
</div>
<p>There are four different local_format_id values (1 through 4). But which is green, and which is red highlighting?</p>
<p>Let’s dig into the formats.</p>
<p>Extracting Formatting Data</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot_formats</span> <span class='op'>&lt;-</span> <span class='fu'>xlsx_formats</span><span class='op'>(</span><span class='va'>pilot_path</span><span class='op'>)</span>
<span class='va'>pilot_formats</span>
</code></pre>
</div>
<pre><code>$local
$local$numFmt
[1] &quot;General&quot; &quot;General&quot; &quot;General&quot;

$local$font
$local$font$bold
[1] FALSE FALSE FALSE

$local$font$italic
[1] FALSE FALSE FALSE

$local$font$underline
[1] NA NA NA

$local$font$strike
[1] FALSE FALSE FALSE

$local$font$vertAlign
[1] NA NA NA

$local$font$size
[1] 12 12 12

$local$font$color
$local$font$color$rgb
[1] &quot;FF000000&quot; &quot;FF000000&quot; &quot;FF000000&quot;

$local$font$color$theme
[1] &quot;text1&quot; &quot;text1&quot; &quot;text1&quot;

$local$font$color$indexed
[1] NA NA NA

$local$font$color$tint
[1] NA NA NA


$local$font$name
[1] &quot;Calibri&quot; &quot;Calibri&quot; &quot;Calibri&quot;

$local$font$family
[1] 2 2 2

$local$font$scheme
[1] &quot;minor&quot; &quot;minor&quot; &quot;minor&quot;


$local$fill
$local$fill$patternFill
$local$fill$patternFill$fgColor
$local$fill$patternFill$fgColor$rgb
[1] NA         &quot;FFED7D31&quot; &quot;FF92D050&quot;

$local$fill$patternFill$fgColor$theme
[1] NA        &quot;accent2&quot; NA       

$local$fill$patternFill$fgColor$indexed
[1] NA NA NA

$local$fill$patternFill$fgColor$tint
[1]        NA 0.5999939        NA


$local$fill$patternFill$bgColor
$local$fill$patternFill$bgColor$rgb
[1] NA         &quot;FFFFFFFF&quot; &quot;FFFFFFFF&quot;

$local$fill$patternFill$bgColor$theme
[1] NA NA NA

$local$fill$patternFill$bgColor$indexed
[1] NA 65 65

$local$fill$patternFill$bgColor$tint
[1] NA NA NA


$local$fill$patternFill$patternType
[1] NA      &quot;solid&quot; &quot;solid&quot;


$local$fill$gradientFill
$local$fill$gradientFill$type
[1] NA NA NA

$local$fill$gradientFill$degree
[1] NA NA NA

$local$fill$gradientFill$left
[1] NA NA NA

$local$fill$gradientFill$right
[1] NA NA NA

$local$fill$gradientFill$top
[1] NA NA NA

$local$fill$gradientFill$bottom
[1] NA NA NA

$local$fill$gradientFill$stop1
$local$fill$gradientFill$stop1$position
[1] NA NA NA

$local$fill$gradientFill$stop1$color
$local$fill$gradientFill$stop1$color$rgb
[1] NA NA NA

$local$fill$gradientFill$stop1$color$theme
[1] NA NA NA

$local$fill$gradientFill$stop1$color$indexed
[1] NA NA NA

$local$fill$gradientFill$stop1$color$tint
[1] NA NA NA



$local$fill$gradientFill$stop2
$local$fill$gradientFill$stop2$position
[1] NA NA NA

$local$fill$gradientFill$stop2$color
$local$fill$gradientFill$stop2$color$rgb
[1] NA NA NA

$local$fill$gradientFill$stop2$color$theme
[1] NA NA NA

$local$fill$gradientFill$stop2$color$indexed
[1] NA NA NA

$local$fill$gradientFill$stop2$color$tint
[1] NA NA NA





$local$border
$local$border$diagonalDown
[1] FALSE FALSE FALSE

$local$border$diagonalUp
[1] FALSE FALSE FALSE

$local$border$outline
[1] FALSE FALSE FALSE

$local$border$left
$local$border$left$style
[1] NA NA NA

$local$border$left$color
$local$border$left$color$rgb
[1] NA NA NA

$local$border$left$color$theme
[1] NA NA NA

$local$border$left$color$indexed
[1] NA NA NA

$local$border$left$color$tint
[1] NA NA NA



$local$border$right
$local$border$right$style
[1] NA NA NA

$local$border$right$color
$local$border$right$color$rgb
[1] NA NA NA

$local$border$right$color$theme
[1] NA NA NA

$local$border$right$color$indexed
[1] NA NA NA

$local$border$right$color$tint
[1] NA NA NA



$local$border$start
$local$border$start$style
[1] NA NA NA

$local$border$start$color
$local$border$start$color$rgb
[1] NA NA NA

$local$border$start$color$theme
[1] NA NA NA

$local$border$start$color$indexed
[1] NA NA NA

$local$border$start$color$tint
[1] NA NA NA



$local$border$end
$local$border$end$style
[1] NA NA NA

$local$border$end$color
$local$border$end$color$rgb
[1] NA NA NA

$local$border$end$color$theme
[1] NA NA NA

$local$border$end$color$indexed
[1] NA NA NA

$local$border$end$color$tint
[1] NA NA NA



$local$border$top
$local$border$top$style
[1] NA NA NA

$local$border$top$color
$local$border$top$color$rgb
[1] NA NA NA

$local$border$top$color$theme
[1] NA NA NA

$local$border$top$color$indexed
[1] NA NA NA

$local$border$top$color$tint
[1] NA NA NA



$local$border$bottom
$local$border$bottom$style
[1] NA NA NA

$local$border$bottom$color
$local$border$bottom$color$rgb
[1] NA NA NA

$local$border$bottom$color$theme
[1] NA NA NA

$local$border$bottom$color$indexed
[1] NA NA NA

$local$border$bottom$color$tint
[1] NA NA NA



$local$border$diagonal
$local$border$diagonal$style
[1] NA NA NA

$local$border$diagonal$color
$local$border$diagonal$color$rgb
[1] NA NA NA

$local$border$diagonal$color$theme
[1] NA NA NA

$local$border$diagonal$color$indexed
[1] NA NA NA

$local$border$diagonal$color$tint
[1] NA NA NA



$local$border$vertical
$local$border$vertical$style
[1] NA NA NA

$local$border$vertical$color
$local$border$vertical$color$rgb
[1] NA NA NA

$local$border$vertical$color$theme
[1] NA NA NA

$local$border$vertical$color$indexed
[1] NA NA NA

$local$border$vertical$color$tint
[1] NA NA NA



$local$border$horizontal
$local$border$horizontal$style
[1] NA NA NA

$local$border$horizontal$color
$local$border$horizontal$color$rgb
[1] NA NA NA

$local$border$horizontal$color$theme
[1] NA NA NA

$local$border$horizontal$color$indexed
[1] NA NA NA

$local$border$horizontal$color$tint
[1] NA NA NA




$local$alignment
$local$alignment$horizontal
[1] &quot;general&quot; &quot;general&quot; &quot;general&quot;

$local$alignment$vertical
[1] &quot;bottom&quot; &quot;bottom&quot; &quot;bottom&quot;

$local$alignment$wrapText
[1] FALSE FALSE FALSE

$local$alignment$readingOrder
[1] &quot;context&quot; &quot;context&quot; &quot;context&quot;

$local$alignment$indent
[1] 0 0 0

$local$alignment$justifyLastLine
[1] FALSE FALSE FALSE

$local$alignment$shrinkToFit
[1] FALSE FALSE FALSE

$local$alignment$textRotation
[1] 0 0 0


$local$protection
$local$protection$locked
[1] TRUE TRUE TRUE

$local$protection$hidden
[1] FALSE FALSE FALSE



$style
$style$numFmt
   Normal 
&quot;General&quot; 

$style$font
$style$font$bold
Normal 
 FALSE 

$style$font$italic
Normal 
 FALSE 

$style$font$underline
Normal 
    NA 

$style$font$strike
Normal 
 FALSE 

$style$font$vertAlign
Normal 
    NA 

$style$font$size
Normal 
    12 

$style$font$color
$style$font$color$rgb
    Normal 
&quot;FF000000&quot; 

$style$font$color$theme
 Normal 
&quot;text1&quot; 

$style$font$color$indexed
Normal 
    NA 

$style$font$color$tint
Normal 
    NA 


$style$font$name
   Normal 
&quot;Calibri&quot; 

$style$font$family
Normal 
     2 

$style$font$scheme
 Normal 
&quot;minor&quot; 


$style$fill
$style$fill$patternFill
$style$fill$patternFill$fgColor
$style$fill$patternFill$fgColor$rgb
Normal 
    NA 

$style$fill$patternFill$fgColor$theme
Normal 
    NA 

$style$fill$patternFill$fgColor$indexed
Normal 
    NA 

$style$fill$patternFill$fgColor$tint
Normal 
    NA 


$style$fill$patternFill$bgColor
$style$fill$patternFill$bgColor$rgb
Normal 
    NA 

$style$fill$patternFill$bgColor$theme
Normal 
    NA 

$style$fill$patternFill$bgColor$indexed
Normal 
    NA 

$style$fill$patternFill$bgColor$tint
Normal 
    NA 


$style$fill$patternFill$patternType
Normal 
    NA 


$style$fill$gradientFill
$style$fill$gradientFill$type
Normal 
    NA 

$style$fill$gradientFill$degree
Normal 
    NA 

$style$fill$gradientFill$left
Normal 
    NA 

$style$fill$gradientFill$right
Normal 
    NA 

$style$fill$gradientFill$top
Normal 
    NA 

$style$fill$gradientFill$bottom
Normal 
    NA 

$style$fill$gradientFill$stop1
$style$fill$gradientFill$stop1$position
Normal 
    NA 

$style$fill$gradientFill$stop1$color
$style$fill$gradientFill$stop1$color$rgb
Normal 
    NA 

$style$fill$gradientFill$stop1$color$theme
Normal 
    NA 

$style$fill$gradientFill$stop1$color$indexed
Normal 
    NA 

$style$fill$gradientFill$stop1$color$tint
Normal 
    NA 



$style$fill$gradientFill$stop2
$style$fill$gradientFill$stop2$position
Normal 
    NA 

$style$fill$gradientFill$stop2$color
$style$fill$gradientFill$stop2$color$rgb
Normal 
    NA 

$style$fill$gradientFill$stop2$color$theme
Normal 
    NA 

$style$fill$gradientFill$stop2$color$indexed
Normal 
    NA 

$style$fill$gradientFill$stop2$color$tint
Normal 
    NA 





$style$border
$style$border$diagonalDown
Normal 
 FALSE 

$style$border$diagonalUp
Normal 
 FALSE 

$style$border$outline
Normal 
 FALSE 

$style$border$left
$style$border$left$style
Normal 
    NA 

$style$border$left$color
$style$border$left$color$rgb
Normal 
    NA 

$style$border$left$color$theme
Normal 
    NA 

$style$border$left$color$indexed
Normal 
    NA 

$style$border$left$color$tint
Normal 
    NA 



$style$border$right
$style$border$right$style
Normal 
    NA 

$style$border$right$color
$style$border$right$color$rgb
Normal 
    NA 

$style$border$right$color$theme
Normal 
    NA 

$style$border$right$color$indexed
Normal 
    NA 

$style$border$right$color$tint
Normal 
    NA 



$style$border$start
$style$border$start$style
Normal 
    NA 

$style$border$start$color
$style$border$start$color$rgb
Normal 
    NA 

$style$border$start$color$theme
Normal 
    NA 

$style$border$start$color$indexed
Normal 
    NA 

$style$border$start$color$tint
Normal 
    NA 



$style$border$end
$style$border$end$style
Normal 
    NA 

$style$border$end$color
$style$border$end$color$rgb
Normal 
    NA 

$style$border$end$color$theme
Normal 
    NA 

$style$border$end$color$indexed
Normal 
    NA 

$style$border$end$color$tint
Normal 
    NA 



$style$border$top
$style$border$top$style
Normal 
    NA 

$style$border$top$color
$style$border$top$color$rgb
Normal 
    NA 

$style$border$top$color$theme
Normal 
    NA 

$style$border$top$color$indexed
Normal 
    NA 

$style$border$top$color$tint
Normal 
    NA 



$style$border$bottom
$style$border$bottom$style
Normal 
    NA 

$style$border$bottom$color
$style$border$bottom$color$rgb
Normal 
    NA 

$style$border$bottom$color$theme
Normal 
    NA 

$style$border$bottom$color$indexed
Normal 
    NA 

$style$border$bottom$color$tint
Normal 
    NA 



$style$border$diagonal
$style$border$diagonal$style
Normal 
    NA 

$style$border$diagonal$color
$style$border$diagonal$color$rgb
Normal 
    NA 

$style$border$diagonal$color$theme
Normal 
    NA 

$style$border$diagonal$color$indexed
Normal 
    NA 

$style$border$diagonal$color$tint
Normal 
    NA 



$style$border$vertical
$style$border$vertical$style
Normal 
    NA 

$style$border$vertical$color
$style$border$vertical$color$rgb
Normal 
    NA 

$style$border$vertical$color$theme
Normal 
    NA 

$style$border$vertical$color$indexed
Normal 
    NA 

$style$border$vertical$color$tint
Normal 
    NA 



$style$border$horizontal
$style$border$horizontal$style
Normal 
    NA 

$style$border$horizontal$color
$style$border$horizontal$color$rgb
Normal 
    NA 

$style$border$horizontal$color$theme
Normal 
    NA 

$style$border$horizontal$color$indexed
Normal 
    NA 

$style$border$horizontal$color$tint
Normal 
    NA 




$style$alignment
$style$alignment$horizontal
   Normal 
&quot;general&quot; 

$style$alignment$vertical
  Normal 
&quot;bottom&quot; 

$style$alignment$wrapText
Normal 
 FALSE 

$style$alignment$readingOrder
   Normal 
&quot;context&quot; 

$style$alignment$indent
Normal 
     0 

$style$alignment$justifyLastLine
Normal 
 FALSE 

$style$alignment$shrinkToFit
Normal 
 FALSE 

$style$alignment$textRotation
Normal 
     0 


$style$protection
$style$protection$locked
Normal 
  TRUE 

$style$protection$hidden
Normal 
 FALSE </code></pre>
</div>
<p>Now open the pilot_formats object by clicking on it in the Environment Tab. In the source pane, explore the nested list by clicking on blue arrows for</p>
<ul>
<li><p>local</p></li>
<li><p>fill</p></li>
<li><p>patternFill</p></li>
<li><p>fgColor</p></li>
<li><p>rgb</p></li>
</ul>
<p>and you will see 3 options in rgb - NA, and 2 RGB colors.</p>
<p>Now let’s pull these with</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot_formats</span><span class='op'>$</span><span class='va'>local</span><span class='op'>$</span><span class='va'>fill</span><span class='op'>$</span><span class='va'>patternFill</span><span class='op'>$</span><span class='va'>fgColor</span><span class='op'>$</span><span class='va'>rgb</span>
</code></pre>
</div>
<pre><code>[1] NA         &quot;FFED7D31&quot; &quot;FF92D050&quot;</code></pre>
</div>
<p>Ignore the first FF, and the rest of the 2 strings represent a code for an RGB color. Go to <a href="https://www.colorhexa.com" class="uri">https://www.colorhexa.com</a> and type in the codes (prefix these with a hashtag) for #ED7D31 and then #92D050.</p>
<p>These two RGB colors are orangish-red and green, respectively.</p>
<p>So if the color “FFED7D31” is present in the cell formatting, that row is a trial participant in the test arm, and if the color “FF92D050”, that row is a trial participant in the control arm.</p>
<p>Now we can mutate to create a new variable, <strong>study_arm</strong> and fill it with “test” and “control”.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot_cells</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>local_format_id</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>pilot_formats</span><span class='op'>$</span><span class='va'>local</span><span class='op'>$</span><span class='va'>fill</span><span class='op'>$</span><span class='va'>patternFill</span><span class='op'>$</span><span class='va'>fgColor</span><span class='op'>$</span><span class='va'>rgb</span> <span class='op'>==</span> <span class='st'>"FFED7D31"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>address</span>, <span class='va'>row</span>, <span class='va'>data_type</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>str_detect</span><span class='op'>(</span><span class='va'>address</span>,<span class='st'>"A"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>tibblerow <span class='op'>=</span> <span class='va'>row</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>tibblerow</span><span class='op'>)</span> <span class='op'>-&gt;</span>
<span class='va'>test_rows</span>
<span class='va'>test_rows</span>
</code></pre>
</div>
<pre><code>[1] 1 3 5 7 9</code></pre>
</div>
<p>Now we can use the test_rows vector to mutate the correct rows to “test” for a new variable, study_arm</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pilot</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rownames_to_column</span><span class='op'>(</span>var <span class='op'>=</span> <span class='st'>"rowname"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>study_arm <span class='op'>=</span> 
    <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>rowname</span> <span class='op'>%in%</span> <span class='va'>test_rows</span> <span class='op'>~</span> <span class='st'>"test"</span>, <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"control"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>rowname</span>, <span class='va'>sbp1</span><span class='op'>:</span><span class='va'>sbp2</span>, <span class='va'>dbp1</span><span class='op'>:</span><span class='va'>dbp2</span>, <span class='va'>study_arm</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 11 x 6
   rowname  sbp1  sbp2  dbp1  dbp2 study_arm
   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
 1 1         147   129    94    82 test     
 2 2         161   163    88    87 control  
 3 3         154   133    96    84 test     
 4 4         150   152    89    88 control  
 5 5         179   159    92    81 test     
 6 6         166   164    92    93 control  
 7 7         168   137    95    82 test     
 8 8         154   155    94    95 control  
 9 9         146   122    92    78 test     
10 10        172   171    95    95 control  
11 11        147   148    88    89 control  </code></pre>
</div>
<p>–</p>
<p>You can get more information about {tidyxl} and where to find formatting like bold, etc. <a href="https://cran.r-project.org/web/packages/tidyxl/vignettes/tidyxl.html">here</a>. The official pkgdown website and reference manual for {tidyxl} can be found <a href="https://nacnudus.github.io/tidyxl/index.html">here</a>. You can unpack lots of badly assembled spreadsheets with the {tidyxl} and {unpivotr} packages. This is well beyond the scope of this post, but there are lots of worked <a href="https://github.com/nacnudus/ukfarm">examples</a>, an online <a href="https://nacnudus.github.io/spreadsheet-munging-strategies/">cookbook</a>, and even <a href="https://www.youtube.com/watch?v=1sinC7wsS5U">screencasts</a>.</p>
<hr />
<p>This blog was created with the {distill} package. Distill is a publication format for scientific and technical writing, native to the web.</p>
<p>Learn more about using Distill at <a href="https://rstudio.github.io/distill" class="uri">https://rstudio.github.io/distill</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
